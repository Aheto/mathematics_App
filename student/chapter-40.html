<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Model Linear Equations Using Algebraic Tiles">
  <title>Mini OpenStax ‚Äî Model Linear Equations Using Algebraic Tiles</title>
  <style>
    :root {
      --green: #006b3d;
      --gold: #cead00;
      --light: #f9f9f9;
      --dark: #2d2d2d;
    }
    body { 
      font-family: 'Segoe UI', system-ui, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #fff; 
      color: var(--dark); 
      line-height: 1.6;
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 1rem; 
    }
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 1rem; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
    }
    .role-badge { 
      background: #e9ecef; 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-size: 0.85rem; 
    }
    .chapter-nav { 
      margin: 1.2rem 0; 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.4rem; 
      justify-content: center; 
    }
    .chapter-btn {
      padding: 0.4rem 0.8rem; 
      background: var(--green); 
      color: white; 
      text-decoration: none; 
      border-radius: 4px; 
      font-size: 0.9rem;
    }
    .chapter-btn.active, .chapter-btn:hover { 
      background: #00502e; 
    }
    .section { 
      margin-bottom: 1.5rem; 
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }
    .word-list { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
      margin: 0.5rem 0; 
    }
    .word-item { 
      background: var(--light); 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-family: monospace; 
      font-size: 0.95rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #f0f7f4;
    }
    .checkpoint, .thought-experiment {
      background: #f8f9fa;
      padding: 1rem;
      border-left: 4px solid var(--gold);
      margin: 1.5rem 0;
    }
    .quiz { 
      margin-top: 2rem; 
    }
    .question { 
      margin-bottom: 1.2rem; 
    }
    .options { 
      margin-left: 1rem; 
    }
    .option { 
      margin: 0.4rem 0; 
    }
    .btn {
      background: var(--green); 
      color: white; 
      border: none; 
      padding: 0.5rem 1rem;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 1rem; 
      margin-right: 0.5rem;
      display: inline-block;
    }
    .btn:hover { 
      background: #00502e; 
    }
    .btn-secondary { 
      background: #6c757d; 
    }
    .btn-secondary:hover { 
      background: #5a6268; 
    }
    .feedback { 
      margin-top: 1.5rem; 
      padding: 1rem; 
      background: var(--light); 
      border-left: 4px solid var(--green); 
    }
    footer { 
      text-align: center; 
      margin-top: 2rem; 
      font-size: 0.9rem; 
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }
    a { 
      color: var(--green); 
      text-decoration: none; 
    }
    a:hover { 
      text-decoration: underline; 
    }
    blockquote {
      margin: 1rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--green);
      color: #555;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Model Linear Equations Using Algebraic Tiles</h1>
        <div class="lo-tags" id="lo-tags">B7.2.3.1.3</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <!-- === REPLACE THIS SECTION PER LESSON === -->
      <div class="section">
        <h2>üéØ What You‚Äôll Learn</h2>
        <ul id="objectives">
          <li>Use algebraic tiles to visually represent linear equations.</li>
          <li>Translate tile models into mathematical expressions.</li>
          <li>Solve equations by manipulating tiles while maintaining balance.</li>
          <li>Describe each step of the solution orally and symbolically.</li>
        </ul>
      </div>

      <div class="section">
        <h2>üî§ Important Words</h2>
        <p id="word-list-desc">Key terms for this lesson:</p>
        <div class="word-list" id="word-list">
          <span class="word-item">algebraic tiles</span>
          <span class="word-item">variable tile</span>
          <span class="word-item">unit tile</span>
          <span class="word-item">zero pair</span>
          <span class="word-item">mathematical expression</span>
          <span class="word-item">solve symbolically</span>
        </div>
      </div>

      <div class="section" id="lesson-content">
        <h2>üìò Lesson Content</h2>
        <p><strong>What Are Algebraic Tiles?</strong></p>
        <p>Algebraic tiles are physical or drawn shapes that represent parts of an algebraic expression:</p>
        <ul>
          <li><strong>Rectangle (long tile)</strong> = variable (e.g., x)</li>
          <li><strong>Small square</strong> = constant (+1 or ‚Äì1)<br>
            ‚Äì Often, green = positive, red = negative</li>
          <li>A <strong>zero pair</strong> = one +1 and one ‚Äì1 tile ‚Üí they cancel out (sum = 0)</li>
        </ul>
        <blockquote>üîë <strong>Key Rule</strong>: To keep the equation balanced, any change made to one side must also be made to the other side.</blockquote>

        <h3>Example 1: Model and Solve 2x + 3 = x + 7</h3>
        <p><strong>Step 1 ‚Äì Build the Equation with Tiles</strong><br>
        ‚Äì Left side: 2 x-tiles + 3 positive unit tiles<br>
        ‚Äì Right side: 1 x-tile + 7 positive unit tiles</p>
        <p><strong>Step 2 ‚Äì Remove x from Both Sides</strong><br>
        ‚Äì Take away 1 x-tile from each side<br>
        ‚Äì Left: 1 x-tile + 3 units<br>
        ‚Äì Right: 6 units</p>
        <p><strong>Step 3 ‚Äì Remove 3 Units from Both Sides</strong><br>
        ‚Äì Left: 1 x-tile<br>
        ‚Äì Right: 3 units ‚Üí Wait! This is incorrect.</p>
        <p><strong>Correction</strong>: Right side starts with 7 units. After removing 3, it has <strong>4</strong> units.<br>
        ‚Üí So x = 4</p>
        <p><strong>Mathematical Expression (Symbolic Solution)</strong>:<br>
        2x + 3 = x + 7<br>
        2x ‚Äì x + 3 = 7<br>
        x + 3 = 7<br>
        x = 7 ‚Äì 3<br>
        x = 4</p>
        <p>‚úÖ <strong>Oral Explanation</strong>:<br>
        ‚ÄúI started with two x‚Äôs and three on the left, and one x and seven on the right. I removed one x from both sides to simplify. Then I took away three units from both sides. That left one x equal to four.‚Äù</p>

        <h3>Example 2: Solve 3x + 2 = x + 8 Using Tiles</h3>
        <p><strong>Tile Model</strong>:<br>
        ‚Äì Left: 3 x-tiles + 2 units<br>
        ‚Äì Right: 1 x-tile + 8 units</p>
        <p><strong>Steps</strong>:</p>
        <ol>
          <li>Remove 1 x-tile from both sides ‚Üí left: 2x + 2; right: 8</li>
          <li>Remove 2 units from both sides ‚Üí left: 2x; right: 6</li>
          <li>Now, 2x = 6 ‚Üí split 6 units into 2 equal groups ‚Üí each x = 3</li>
        </ol>
        <p><strong>Symbolic Record</strong>:<br>
        3x + 2 = x + 8<br>
        3x ‚Äì x + 2 = 8<br>
        2x + 2 = 8<br>
        2x = 6<br>
        x = 3</p>
        <p>‚úÖ <strong>Answer</strong>: x = 3</p>

        <h3>Example 3: Equations with Negative Terms (Using Zero Pairs)</h3>
        <p>Solve: x ‚Äì 2 = 5</p>
        <p><strong>Challenge</strong>: You can‚Äôt ‚Äúremove‚Äù ‚Äì2 physically. Instead, <strong>add 2 positive units to both sides</strong> to cancel the ‚Äì2.</p>
        <p><strong>Tile Steps</strong>:</p>
        <ul>
          <li>Left: 1 x-tile + 2 negative unit tiles</li>
          <li>Right: 5 positive unit tiles</li>
          <li>Add 2 positive unit tiles to both sides</li>
          <li>Left: x + (‚Äì2 + 2) = x + 0 = x</li>
          <li>Right: 5 + 2 = 7</li>
        </ul>
        <p><strong>Result</strong>: x = 7</p>
        <p><strong>Symbolic</strong>:<br>
        x ‚Äì 2 = 5<br>
        x ‚Äì 2 + 2 = 5 + 2<br>
        x = 7</p>
        <blockquote>üí° <strong>Tip</strong>: When you see subtraction, think ‚Äúadd the opposite.‚Äù Use <strong>zero pairs</strong> to remove negative tiles.</blockquote>

        <p><strong>Tips for Success</strong></p>
        <ul>
          <li>Always <strong>sketch or build both sides</strong> before solving.</li>
          <li>Use <strong>different colors</strong> for positive/negative tiles.</li>
          <li>After solving with tiles, <strong>write the symbolic steps</strong> to connect concrete to abstract.</li>
          <li>Say your steps out loud: ‚ÄúI removed one x from both sides to keep the balance.‚Äù</li>
        </ul>
      </div>

      <div class="section">
        <h2>‚úÖ Check Your Understanding</h2>
        <div class="checkpoint" id="checkpoint-questions">
          <ol>
            <li>Draw or describe how you would model x + 4 = 9 using algebraic tiles. What is the solution?</li>
            <li>Why do we add positive tiles to both sides when we have a negative term like x ‚Äì 3 = 5?</li>
            <li>Solve using algebraic tiles:<br>2x + 1 = x + 6<br>Show your tile steps and write the symbolic solution.</li>
            <li>Explain in your own words: How do algebraic tiles help you understand what ‚Äúsolving for x‚Äù really means?</li>
          </ol>
          <p><em>‚úÖ Pause and reflect: Try drawing algebraic tiles on paper for the equation 3x = 12. How would you find x?</em></p>
        </div>
      </div>

      <div class="section" id="next-preview">
        <h3>üîú Coming Up</h3>
        <p>In Lesson 42, you‚Äôll learn how to solve linear equations symbolically using the balance method‚Äîwithout tiles‚Äîbut using the same logical steps you‚Äôve practiced!</p>
      </div>
      <!-- === END REPLACE SECTION === -->

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>üë§ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>üìù Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>

      <!-- FOOTER -->
      <footer>
        <a href="../premium.html" style="display:block; margin-bottom:0.5rem;">‚ú® Unlock Premium Features</a>
        <a href="#" id="send-analytics" style="color:#6c757d;">üì§ Send Anonymous Usage Data</a>
        <br>
        <a href="../dashboard.html">üìä View Dashboard</a>
      </footer>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      // === Seeded RNG & Shuffle ===
      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      // === CONFIGURATION ===
      const currentChapter = 40; // ‚Üê Lesson 41
      const MAX_CHAPTER = 300;
      const WHATSAPP_NUMBER = "233257320201";

      // === ANALYTICS MODULE ===
      const ANALYTICS_KEY = 'miniopenstax_analytics_consent';
      const EVENTS_KEY = 'miniopenstax_events';

      function isAnalyticsEnabled() {
        return localStorage.getItem(ANALYTICS_KEY) === '1';
      }

      function logEvent(eventType, data = {}) {
        if (!isAnalyticsEnabled()) return;
        const event = { type: eventType, timestamp: Date.now(), lesson: currentChapter, data };
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        events.push(event);
        localStorage.setItem(EVENTS_KEY, JSON.stringify(events));
        if (events.length >= 20) sendAnalyticsEvents();
      }

      function enableAnalytics() {
        localStorage.setItem(ANALYTICS_KEY, '1');
      }

      function sendAnalyticsEvents() {
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        if (events.length === 0) return;
        const summary = {
          lessons_attempted: [...new Set(events.map(e => e.lesson))].length,
          quizzes_submitted: events.filter(e => e.type === 'quiz_submitted').length,
          mastery_count: events.filter(e => e.type === 'mastery_achieved').length,
          first_event: new Date(events[0].timestamp).toISOString().split('T')[0],
          last_event: new Date(events[events.length - 1].timestamp).toISOString().split('T')[0]
        };
        const report = `*Mini OpenStax ‚Äî Anonymous Usage Report*\n` +
          `Lessons Tried: ${summary.lessons_attempted}\n` +
          `Quizzes Taken: ${summary.quizzes_submitted}\n` +
          `Mastery Achieved: ${summary.mastery_count}\n` +
          `Period: ${summary.first_event} to ${summary.last_event}\n\n` +
          `Thank you for helping improve literacy tools!`;
        localStorage.removeItem(EVENTS_KEY);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        window.open(url, '_blank');
      }

      // === TYPO CORRECTIONS (for copied content) ===
      const TYPO_CORRECTIONS = [
        [/f resh/g, 'fresh'], [/p unch/g, 'punch'], [/slep t/g, 'slept'],
        [/crep t/g, 'crept'], [/p lant/g, 'plant'], [/p ath/g, 'path'],
        [/f roth/g, 'froth'], [/p eck/g, 'peck'], [/f luck/g, 'pluck'],
        [/p luck/g, 'pluck'], [/f ling/g, 'fling'], [/p ass/g, 'pass'],
        [/f uss/g, 'fuss'], [/sp ell/g, 'spell'], [/f uzz/g, 'fuzz'],
        [/thef t/g, 'theft'], [/thrif t/g, 'thrift'], [/dep th/g, 'depth'],
        [/fif th/g, 'fifth'], [/st ink/g, 'stink'], [/wr ink/g, 'wring']
      ];

      // === CHAPTER CONTENT (EDIT PER FILE) ===
      const CHAPTER_CONFIG = {
        title: "Model Linear Equations Using Algebraic Tiles",
        loTags: ["B7.2.3.1.3"],
        objectives: [
          "Use algebraic tiles to visually represent linear equations.",
          "Translate tile models into mathematical expressions.",
          "Solve equations by manipulating tiles while maintaining balance.",
          "Describe each step of the solution orally and symbolically."
        ],
        words: [
          "algebraic tiles",
          "variable tile",
          "unit tile",
          "zero pair",
          "mathematical expression",
          "solve symbolically"
        ],
        wordListDesc: "Key terms for this lesson:",
        checkpointQuestions: `
          <ol>
            <li>Draw or describe how you would model x + 4 = 9 using algebraic tiles. What is the solution?</li>
            <li>Why do we add positive tiles to both sides when we have a negative term like x ‚Äì 3 = 5?</li>
            <li>Solve using algebraic tiles:<br>2x + 1 = x + 6<br>Show your tile steps and write the symbolic solution.</li>
            <li>Explain in your own words: How do algebraic tiles help you understand what ‚Äúsolving for x‚Äù really means?</li>
          </ol>
          <p><em>‚úÖ Pause and reflect: Try drawing algebraic tiles on paper for the equation 3x = 12. How would you find x?</em></p>
        `,
        nextPreview: "In Lesson 42, you‚Äôll learn how to solve linear equations symbolically using the balance method‚Äîwithout tiles‚Äîbut using the same logical steps you‚Äôve practiced!",
        assessmentItems: [
          // Add 20 items when ready
        ]
      };

      // === RENDERING FUNCTIONS ===
      function renderContent() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];

        // Objectives
        document.getElementById('objectives').innerHTML =
          CHAPTER_CONFIG.objectives.map(obj => `<li>${obj}</li>`).join('');

        // Words
        document.getElementById('word-list-desc').textContent = CHAPTER_CONFIG.wordListDesc;
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.words.map(w => `<span class="word-item">${w}</span>`).join('');

        // Checkpoint
        document.getElementById('checkpoint-questions').innerHTML = CHAPTER_CONFIG.checkpointQuestions;

        // Next preview
        document.getElementById('next-preview').innerHTML = `
          <h3>üîú Coming Up</h3>
          <p>${CHAPTER_CONFIG.nextPreview}</p>
        `;
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} ‚Üí ‚úÖ ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} ‚Üí ‚ùå Your answer: ${item.options.find(o => o.id === ans)?.text || '‚Äî'} | ‚úÖ ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        logEvent('quiz_submitted', { score, time_sec: timeOnTask, mastery, attempts });
        if (mastery) logEvent('mastery_achieved', {});

        let report = `*Mini OpenStax ‚Äî ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) ‚Äî ${mastery ? '‚úÖ MASTERED' : '‚ùå Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `‚úÖ CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `‚ùå INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>üìä Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'üéâ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'You‚Äôve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;text-decoration:none;">
              üì≤ Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const savedRole = localStorage.getItem('user_role') || 'student';
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');
        const roleBadge = document.querySelector('.role-badge');
        roleBadge.textContent = savedRole === 'instructor' ? 'Instructor View' : 'Student View';

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved} (${savedRole})</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">‚úÖ Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">‚úèÔ∏è Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
            logEvent('lesson_start', {});
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `
              <button type="button" class="btn" id="save-new">üíæ Save and Start Quiz</button>
              <div style="margin-top:1rem; font-size:0.9rem;">
                <label>
                  <input type="checkbox" id="teacher-mode"> 
                  I'm an instructor (analytics auto-enabled to improve lessons)
                </label>
              </div>
            `;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                const isTeacher = document.getElementById('teacher-mode').checked;
                localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
                if (isTeacher) enableAnalytics();
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
                roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
                logEvent('lesson_start', {});
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `
            <button type="button" class="btn" id="save-first">üíæ Save and Start Quiz</button>
            <div style="margin-top:1rem; font-size:0.9rem;">
              <label>
                <input type="checkbox" id="teacher-mode"> 
                I'm an instructor (analytics auto-enabled to improve lessons)
              </label>
            </div>
          `;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              const isTeacher = document.getElementById('teacher-mode').checked;
              localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
              if (isTeacher) enableAnalytics();
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
              roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
              logEvent('lesson_start', {});
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        renderContent();
        renderNavigation();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('send-analytics').onclick = (e) => {
          e.preventDefault();
          if (confirm('Send anonymous usage data to help improve Mini OpenStax?')) {
            sendAnalyticsEvents();
          }
        };
      });

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
