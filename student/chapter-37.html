<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Mini OpenStax: Use Properties of the Four Operations to Simplify Algebraic Expressions with Rational Coefficients">
  <title>Mini OpenStax â€” Use Properties of the Four Operations to Simplify Algebraic Expressions with Rational Coefficients</title>
  <style>
    :root {
      --green: #006b3d;
      --gold: #cead00;
      --light: #f9f9f9;
      --dark: #2d2d2d;
    }
    body { 
      font-family: 'Segoe UI', system-ui, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #fff; 
      color: var(--dark); 
      line-height: 1.6;
    }
    .container { 
      max-width: 800px; 
      margin: 0 auto; 
      padding: 1rem; 
    }
    .header { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      margin-bottom: 1rem; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
    }
    .role-badge { 
      background: #e9ecef; 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-size: 0.85rem; 
    }
    .chapter-nav { 
      margin: 1.2rem 0; 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.4rem; 
      justify-content: center; 
    }
    .chapter-btn {
      padding: 0.4rem 0.8rem; 
      background: var(--green); 
      color: white; 
      text-decoration: none; 
      border-radius: 4px; 
      font-size: 0.9rem;
      min-width: 80px;
      text-align: center;
    }
    .chapter-btn.active, .chapter-btn:hover { 
      background: #00502e; 
    }
    .section { 
      margin-bottom: 1.5rem; 
      padding-bottom: 1rem;
      border-bottom: 1px solid #eee;
    }
    .word-list { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 0.5rem; 
      margin: 0.5rem 0; 
    }
    .word-item { 
      background: var(--light); 
      padding: 0.25rem 0.5rem; 
      border-radius: 4px; 
      font-family: monospace; 
      font-size: 0.95rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
      text-align: left;
    }
    th {
      background-color: #f0f7f4;
    }
    .checkpoint, .thought-experiment {
      background: #f8f9fa;
      padding: 1rem;
      border-left: 4px solid var(--gold);
      margin: 1.5rem 0;
    }
    .quiz { 
      margin-top: 2rem; 
    }
    .question { 
      margin-bottom: 1.2rem; 
    }
    .options { 
      margin-left: 1rem; 
    }
    .option { 
      margin: 0.4rem 0; 
    }
    .btn {
      background: var(--green); 
      color: white; 
      border: none; 
      padding: 0.5rem 1rem;
      border-radius: 4px; 
      cursor: pointer; 
      font-size: 1rem; 
      margin-right: 0.5rem;
      display: inline-block;
    }
    .btn:hover { 
      background: #00502e; 
    }
    .btn-secondary { 
      background: #6c757d; 
    }
    .btn-secondary:hover { 
      background: #5a6268; 
    }
    .feedback { 
      margin-top: 1.5rem; 
      padding: 1rem; 
      background: var(--light); 
      border-left: 4px solid var(--green); 
    }
    footer { 
      text-align: center; 
      margin-top: 2rem; 
      font-size: 0.9rem; 
      padding-top: 1.5rem;
      border-top: 1px solid #eee;
    }
    a { 
      color: var(--green); 
      text-decoration: none; 
    }
    a:hover { 
      text-decoration: underline; 
    }
    blockquote {
      margin: 1rem 0;
      padding-left: 1rem;
      border-left: 3px solid var(--green);
      color: #555;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div>
        <h1 id="chapter-title">Use Properties of the Four Operations to Simplify Algebraic Expressions with Rational Coefficients</h1>
        <div class="lo-tags" id="lo-tags">B7.2.2.1.5</div>
      </div>
      <div class="role-badge">Student View</div>
    </div>

    <nav class="chapter-nav" id="chapter-nav"></nav>

    <main id="main-content">
      <!-- === REPLACE THIS SECTION PER LESSON === -->
      <div class="section">
        <h2>ğŸ¯ What Youâ€™ll Learn</h2>
        <ul id="objectives"></ul>
      </div>

      <div class="section">
        <h2>ğŸ”¤ Important Words</h2>
        <p id="word-list-desc">Key terms for this lesson:</p>
        <div class="word-list" id="word-list"></div>
      </div>

      <div class="section" id="lesson-content">
        <h3>1. Review of Number Properties in Algebra</h3>
        <table>
          <thead>
            <tr>
              <th>Property</th>
              <th>Rule</th>
              <th>Algebraic Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Commutative (Addition & Multiplication)</strong></td>
              <td>Order doesnâ€™t matter</td>
              <td>a + b = b + a<br>ab = ba</td>
            </tr>
            <tr>
              <td><strong>Associative (Addition & Multiplication)</strong></td>
              <td>Grouping doesnâ€™t matter</td>
              <td>(a + b) + c = a + (b + c)<br>(ab)c = a(bc)</td>
            </tr>
            <tr>
              <td><strong>Distributive</strong></td>
              <td>Multiply across a sum/difference</td>
              <td>a(b + c) = ab + ac</td>
            </tr>
            <tr>
              <td><strong>Identity</strong></td>
              <td>Adding 0 or multiplying by 1 changes nothing</td>
              <td>a + 0 = a<br>a Â· 1 = a</td>
            </tr>
            <tr>
              <td><strong>Inverse</strong></td>
              <td>Opposites cancel</td>
              <td>a + (-a) = 0<br>a Â· (1/a) = 1 (if a â‰  0)</td>
            </tr>
          </tbody>
        </table>
        <blockquote>âœ… These properties allow us to <strong>rearrange, regroup, and factor</strong> expressions for simplification.</blockquote>

        <h3>2. Simplifying Using the Distributive Property</h3>
        <p>The distributive property is essential when removing parentheses.</p>
        <p><strong>Example 1: Expand and simplify</strong><br>
        3xÂ²y + 2xyÂ² - 4xÂ²y - 6xyÂ²</p>
        <p><strong>Step 1: Group like terms</strong><br>
        - xÂ²y-terms: 3xÂ²y - 4xÂ²y = -xÂ²y<br>
        - xyÂ²-terms: 2xyÂ² - 6xyÂ² = -4xyÂ²</p>
        <p>âœ… <strong>Answer</strong>: -xÂ²y - 4xyÂ²</p>
        <blockquote>ğŸ” <strong>Property Used</strong>: Commutative (to reorder), Associative (to group), Inverse (to combine opposites).</blockquote>

        <p><strong>Example 2: Apply distributive property first</strong><br>
        3xy Ã— 2 + (6xÂ²yÂ³)/(2yÂ²)</p>
        <p><strong>Step 1: Multiply</strong><br>
        3xy Ã— 2 = 6xy</p>
        <p><strong>Step 2: Simplify division</strong><br>
        (6xÂ²yÂ³)/(2yÂ²) = 3xÂ²y</p>
        <p>âœ… <strong>Simplified expression</strong>: 6xy + 3xÂ²y</p>
        <blockquote>ğŸ’¡ No like terms â†’ cannot combine further.</blockquote>

        <h3>3. Combining Operations: Multiplication, Division, Addition</h3>
        <p><strong>Example 3: Full simplification</strong><br>
        (15pÂ³qÂ² Ã— 12xâµyÂ³) / (36pq Ã— 45xy)</p>
        <p><strong>Step 1: Multiply numerators and denominators</strong><br>
        Numerator: 15 Ã— 12 = 180; pÂ³qÂ²xâµyÂ³<br>
        Denominator: 36 Ã— 45 = 1620; pqxy</p>
        <p><strong>Step 2: Simplify coefficient</strong><br>
        180/1620 = 1/9</p>
        <p><strong>Step 3: Simplify variables</strong><br>
        - pÂ³/p = pÂ²<br>
        - qÂ²/q = q<br>
        - xâµ/x = xâ´<br>
        - yÂ³/y = yÂ²</p>
        <p>âœ… <strong>Answer</strong>: (1/9)pÂ²q xâ´ yÂ²</p>

        <h3>4. Working with Rational Coefficients</h3>
        <p>â€œRational coefficientsâ€ include fractions and decimals, but Grade 7 focuses on <strong>whole numbers and simple fractions</strong>.</p>
        <p><strong>Example 4: Fractional coefficients</strong><br>
        (7a - 7a)/3 + (14a)/4</p>
        <p><strong>Step 1: Simplify numerator</strong><br>
        7a - 7a = 0 â†’ First term = 0</p>
        <p><strong>Step 2: Simplify second term</strong><br>
        (14a)/4 = (7a)/2</p>
        <p>âœ… <strong>Answer</strong>: (7a)/2</p>
        <blockquote>ğŸ“Œ <strong>Property Used</strong>: Inverse (7a âˆ’ 7a = 0), Identity (0/3 = 0)</blockquote>

        <h3>5. Real-World Application</h3>
        <blockquote>A rectangle has length 3x and width 2x + 4.<br>
        Find its <strong>area</strong> and <strong>perimeter</strong>.</blockquote>
        <ul>
          <li><strong>Area</strong> = 3x(2x + 4) = 6xÂ² + 12x â†’ <strong>Distributive property</strong></li>
          <li><strong>Perimeter</strong> = 2(3x) + 2(2x + 4) = 6x + 4x + 8 = 10x + 8 â†’ <strong>Distributive + combining like terms</strong></li>
        </ul>

        <h3>Core Competencies Developed</h3>
        <ul>
          <li><strong>Critical Thinking and Problem Solving (CP)</strong>: Choosing the right property for each step.</li>
          <li><strong>Communication and Collaboration (CC)</strong>: Explaining why 3xÂ²y - 4xÂ²y = -xÂ²y using the inverse property.</li>
          <li><strong>Creativity and Innovation (CI)</strong>: Designing expressions that require multiple properties to simplify.</li>
        </ul>

        <h3>End of Algebraic Expressions Unit</h3>
        <p>Congratulations! Youâ€™ve now mastered:</p>
        <ul>
          <li>Translating words into algebraic expressions</li>
          <li>Adding, subtracting, multiplying, and dividing algebraic terms</li>
          <li>Substituting values to evaluate expressions</li>
          <li>Using number properties to simplify complex expressions</li>
        </ul>
        <p>These skills are the foundation for <strong>solving equations</strong>, <strong>graphing functions</strong>, and <strong>advanced problem-solving</strong> in mathematics.</p>
      </div>

      <div class="section">
        <h2>âœ… Check Your Understanding</h2>
        <div class="checkpoint" id="checkpoint-questions"></div>
      </div>

      <div class="section" id="next-preview">
        <h3>ğŸ”œ Coming Up</h3>
        <p>You've completed the Algebraic Expressions unit! The next topic will build on these foundational skills with new mathematical concepts.</p>
      </div>
      <!-- === END REPLACE SECTION === -->

      <div id="student-name-prompt" class="section" style="display:none;">
        <h2>ğŸ‘¤ Your Name</h2>
        <div id="name-display"></div>
        <input type="text" id="student-name" placeholder="Enter your name" maxlength="30"
          style="padding:0.5rem;font-size:1rem;width:100%;margin:0.5rem 0;display:none;">
        <div id="name-buttons"></div>
      </div>

      <div class="quiz" id="quiz-container" style="display:none;">
        <h2>ğŸ“ Quick Check (20 Questions)</h2>
        <p>Select the best answer for each question.</p>
        <form id="quiz-form"></form>
        <button type="button" class="btn" id="submit-quiz">Check Answers</button>
      </div>

      <div id="feedback"></div>

      <!-- FOOTER -->
      <footer>
        <a href="../premium.html" style="display:block; margin-bottom:0.5rem;">âœ¨ Unlock Premium Features</a>
        <a href="#" id="send-analytics" style="color:#6c757d;">ğŸ“¤ Send Anonymous Usage Data</a>
        <br>
        <a href="../dashboard.html">ğŸ“Š View Dashboard</a>
      </footer>
    </main>
  </div>

  <script>
    (function () {
      'use strict';
      window.startTime = Date.now();

      // === Seeded RNG & Shuffle ===
      function createSeededRNG(seed) {
        let state = Math.abs((seed * 9301 + 49297) % 233280);
        return () => {
          state = (state * 9301 + 49297) % 233280;
          return state / 233280;
        };
      }

      function shuffleWithSeed(array, seed) {
        const rng = createSeededRNG(seed);
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(rng() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      // === CONFIGURATION ===
      const currentChapter = 37; // â† UPDATE PER LESSON
      const MAX_CHAPTER = 300;
      const WHATSAPP_NUMBER = "233257320201";

      // === ANALYTICS MODULE ===
      const ANALYTICS_KEY = 'miniopenstax_analytics_consent';
      const EVENTS_KEY = 'miniopenstax_events';

      function isAnalyticsEnabled() {
        return localStorage.getItem(ANALYTICS_KEY) === '1';
      }

      function logEvent(eventType, data = {}) {
        if (!isAnalyticsEnabled()) return;
        const event = { type: eventType, timestamp: Date.now(), lesson: currentChapter, data };
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        events.push(event);
        localStorage.setItem(EVENTS_KEY, JSON.stringify(events));
        if (events.length >= 20) sendAnalyticsEvents();
      }

      function enableAnalytics() {
        localStorage.setItem(ANALYTICS_KEY, '1');
      }

      function sendAnalyticsEvents() {
        const events = JSON.parse(localStorage.getItem(EVENTS_KEY) || '[]');
        if (events.length === 0) return;
        const summary = {
          lessons_attempted: [...new Set(events.map(e => e.lesson))].length,
          quizzes_submitted: events.filter(e => e.type === 'quiz_submitted').length,
          mastery_count: events.filter(e => e.type === 'mastery_achieved').length,
          first_event: new Date(events[0].timestamp).toISOString().split('T')[0],
          last_event: new Date(events[events.length - 1].timestamp).toISOString().split('T')[0]
        };
        const report = `*Mini OpenStax â€” Anonymous Usage Report*\n` +
          `Lessons Tried: ${summary.lessons_attempted}\n` +
          `Quizzes Taken: ${summary.quizzes_submitted}\n` +
          `Mastery Achieved: ${summary.mastery_count}\n` +
          `Period: ${summary.first_event} to ${summary.last_event}\n\n` +
          `Thank you for helping improve literacy tools!`;
        localStorage.removeItem(EVENTS_KEY);
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        window.open(url, '_blank');
      }

      // === TYPO CORRECTIONS (for copied content) ===
      const TYPO_CORRECTIONS = [
        [/f resh/g, 'fresh'], [/p unch/g, 'punch'], [/slep t/g, 'slept'],
        [/crep t/g, 'crept'], [/p lant/g, 'plant'], [/p ath/g, 'path'],
        [/f roth/g, 'froth'], [/p eck/g, 'peck'], [/f luck/g, 'pluck'],
        [/p luck/g, 'pluck'], [/f ling/g, 'fling'], [/p ass/g, 'pass'],
        [/f uss/g, 'fuss'], [/sp ell/g, 'spell'], [/f uzz/g, 'fuzz'],
        [/thef t/g, 'theft'], [/thrif t/g, 'thrift'], [/dep th/g, 'depth'],
        [/fif th/g, 'fifth'], [/st ink/g, 'stink'], [/wr ink/g, 'wring']
      ];

      // === CHAPTER CONTENT (EDIT PER FILE) ===
      const CHAPTER_CONFIG = {
        title: "Use Properties of the Four Operations to Simplify Algebraic Expressions with Rational Coefficients",
        loTags: ["B7.2.2.1.5"],
        objectives: [
          "Apply the commutative, associative, distributive, identity, and inverse properties to simplify algebraic expressions.",
          "Combine like terms efficiently using these properties.",
          "Simplify complex expressions involving multiplication, division, addition, and subtraction of terms with rational coefficients.",
          "Justify each simplification step using a named property."
        ],
        words: [
          "Commutative",
          "Associative",
          "Distributive",
          "Identity",
          "Inverse",
          "Rational coefficient",
          "Simplify"
        ],
        wordListDesc: "Key terms for this lesson:",
        checkpointQuestions: `
          <ol>
            <li>Simplify:
              <br>a) 3xÂ²y + 2xyÂ² - 4xÂ²y - 6xyÂ²
              <br>b) (7x + 4x - 2x) / (3x)</li>
            <li>Evaluate using properties:<br>
              (15pÂ³qÂ² Ã— 12xâµyÂ³) / (36pq Ã— 45xy)</li>
            <li>Simplify:<br>
              (7a - 7a)/3 + (14a)/4</li>
            <li>Which property justifies:<br>
              5x + 3x = 3x + 5x?<br>
              2(x + 3) = 2x + 6?</li>
          </ol>
          <p><em>Confirm your understanding before moving on.</em></p>
        `,
        nextPreview: "You've completed the Algebraic Expressions unit! The next topic will build on these foundational skills with new mathematical concepts.",
        assessmentItems: [
          { id: "1", prompt: "Which property says a + b = b + a?", options: [
            {id:"a",text:"Associative",is_correct:false},
            {id:"b",text:"Commutative",is_correct:true},
            {id:"c",text:"Distributive",is_correct:false},
            {id:"d",text:"Identity",is_correct:false}
          ]},
          { id: "2", prompt: "Which property is used in 3(x + 2) = 3x + 6?", options: [
            {id:"a",text:"Commutative",is_correct:false},
            {id:"b",text:"Associative",is_correct:false},
            {id:"c",text:"Distributive",is_correct:true},
            {id:"d",text:"Inverse",is_correct:false}
          ]},
          { id: "3", prompt: "Simplify: 4xÂ²y - 7xÂ²y", options: [
            {id:"a",text:"3xÂ²y",is_correct:false},
            {id:"b",text:"-3xÂ²y",is_correct:true},
            {id:"c",text:"11xÂ²y",is_correct:false},
            {id:"d",text:"-11xÂ²y",is_correct:false}
          ]},
          { id: "4", prompt: "Simplify: 5a + 3b - 2a + b", options: [
            {id:"a",text:"3a + 4b",is_correct:true},
            {id:"b",text:"7a + 4b",is_correct:false},
            {id:"c",text:"3a + 2b",is_correct:false},
            {id:"d",text:"7a + 2b",is_correct:false}
          ]},
          { id: "5", prompt: "Which property says (ab)c = a(bc)?", options: [
            {id:"a",text:"Commutative",is_correct:false},
            {id:"b",text:"Associative",is_correct:true},
            {id:"c",text:"Distributive",is_correct:false},
            {id:"d",text:"Identity",is_correct:false}
          ]},
          { id: "6", prompt: "True or False: a + 0 = a shows the identity property.", options: [
            {id:"a",text:"True",is_correct:true},
            {id:"b",text:"False",is_correct:false}
          ]},
          { id: "7", prompt: "Simplify: 2x(3x + 4)", options: [
            {id:"a",text:"6x + 8",is_correct:false},
            {id:"b",text:"6xÂ² + 4",is_correct:false},
            {id:"c",text:"6xÂ² + 8x",is_correct:true},
            {id:"d",text:"5x + 4",is_correct:false}
          ]},
          { id: "8", prompt: "Simplify: (8xÂ³yÂ²)/(4xy)", options: [
            {id:"a",text:"2xÂ²y",is_correct:true},
            {id:"b",text:"2xy",is_correct:false},
            {id:"c",text:"4xÂ²y",is_correct:false},
            {id:"d",text:"4xy",is_correct:false}
          ]},
          { id: "9", prompt: "Which shows the inverse property?", options: [
            {id:"a",text:"5 + 0 = 5",is_correct:false},
            {id:"b",text:"5 + (-5) = 0",is_correct:true},
            {id:"c",text:"5 Ã— 1 = 5",is_correct:false},
            {id:"d",text:"5 Ã— 2 = 2 Ã— 5",is_correct:false}
          ]},
          { id: "10", prompt: "Simplify: 3xÂ²y + 5xyÂ² - xÂ²y - 2xyÂ²", options: [
            {id:"a",text:"2xÂ²y + 3xyÂ²",is_correct:true},
            {id:"b",text:"4xÂ²y + 7xyÂ²",is_correct:false},
            {id:"c",text:"2xy + 3xy",is_correct:false},
            {id:"d",text:"4xÂ³yÂ³",is_correct:false}
          ]},
          { id: "11", prompt: "Area of rectangle with sides 2x and (x + 3):", options: [
            {id:"a",text:"2x + 3",is_correct:false},
            {id:"b",text:"3x + 3",is_correct:false},
            {id:"c",text:"2xÂ² + 6x",is_correct:true},
            {id:"d",text:"2xÂ² + 3",is_correct:false}
          ]},
          { id: "12", prompt: "Simplify: (12aâ´bÂ³)/(6aÂ²b)", options: [
            {id:"a",text:"2aÂ²bÂ²",is_correct:true},
            {id:"b",text:"6aÂ²bÂ²",is_correct:false},
            {id:"c",text:"2ab",is_correct:false},
            {id:"d",text:"6ab",is_correct:false}
          ]},
          { id: "13", prompt: "Which property allows you to write 3x + 5x as (3 + 5)x?", options: [
            {id:"a",text:"Commutative",is_correct:false},
            {id:"b",text:"Associative",is_correct:false},
            {id:"c",text:"Distributive",is_correct:true},
            {id:"d",text:"Inverse",is_correct:false}
          ]},
          { id: "14", prompt: "Simplify: 7m - 3n + 2m + 5n", options: [
            {id:"a",text:"9m + 2n",is_correct:true},
            {id:"b",text:"5m + 8n",is_correct:false},
            {id:"c",text:"9m + 8n",is_correct:false},
            {id:"d",text:"5m + 2n",is_correct:false}
          ]},
          { id: "15", prompt: "Simplify: (9xâµyâ´)/(3xÂ³yÂ²)", options: [
            {id:"a",text:"3xÂ²yÂ²",is_correct:true},
            {id:"b",text:"6xÂ²yÂ²",is_correct:false},
            {id:"c",text:"3xy",is_correct:false},
            {id:"d",text:"6xy",is_correct:false}
          ]},
          { id: "16", prompt: "Which is NOT a number property?", options: [
            {id:"a",text:"Commutative",is_correct:false},
            {id:"b",text:"Associative",is_correct:false},
            {id:"c",text:"Distributive",is_correct:false},
            {id:"d",text:"Exponential",is_correct:true}
          ]},
          { id: "17", prompt: "Simplify: 4(2x - 3) + 5x", options: [
            {id:"a",text:"8x - 12",is_correct:false},
            {id:"b",text:"13x - 12",is_correct:true},
            {id:"c",text:"8x - 7",is_correct:false},
            {id:"d",text:"13x - 7",is_correct:false}
          ]},
          { id: "18", prompt: "Perimeter of rectangle with sides x and (x + 2):", options: [
            {id:"a",text:"2x + 2",is_correct:false},
            {id:"b",text:"4x + 2",is_correct:false},
            {id:"c",text:"4x + 4",is_correct:true},
            {id:"d",text:"2x + 4",is_correct:false}
          ]},
          { id: "19", prompt: "Simplify: (15pÂ³q)/(5pq)", options: [
            {id:"a",text:"3pÂ²",is_correct:true},
            {id:"b",text:"10pÂ²",is_correct:false},
            {id:"c",text:"3pq",is_correct:false},
            {id:"d",text:"10pq",is_correct:false}
          ]},
          { id: "20", prompt: "Which property justifies 4x Ã— 1 = 4x?", options: [
            {id:"a",text:"Commutative",is_correct:false},
            {id:"b",text:"Associative",is_correct:false},
            {id:"c",text:"Distributive",is_correct:false},
            {id:"d",text:"Identity",is_correct:true}
          ]}
        ]
      };

      // === RENDERING FUNCTIONS ===
      function renderContent() {
        document.getElementById('chapter-title').textContent = CHAPTER_CONFIG.title;
        document.getElementById('lo-tags').textContent = CHAPTER_CONFIG.loTags[0];

        // Objectives
        document.getElementById('objectives').innerHTML =
          CHAPTER_CONFIG.objectives.map(obj => `<li>${obj}</li>`).join('');

        // Words
        document.getElementById('word-list-desc').textContent = CHAPTER_CONFIG.wordListDesc;
        document.getElementById('word-list').innerHTML =
          CHAPTER_CONFIG.words.map(w => `<span class="word-item">${w}</span>`).join('');

        // Checkpoint
        document.getElementById('checkpoint-questions').innerHTML = CHAPTER_CONFIG.checkpointQuestions;

        // Next preview
        document.getElementById('next-preview').innerHTML = `
          <h3>ğŸ”œ Coming Up</h3>
          <p>${CHAPTER_CONFIG.nextPreview}</p>
        `;
      }

      function renderNavigation() {
        const nav = document.getElementById('chapter-nav');
        const buttons = [{ label: "Home", url: "../index.html", active: false }];
        for (let i = 0; i < 4; i++) {
          const c = currentChapter + i;
          const lessonNum = c + 1;
          if (c > MAX_CHAPTER) break;
          buttons.push({
            label: `Lesson ${lessonNum}`,
            url: `chapter-${c}.html`,
            active: i === 0
          });
        }
        nav.innerHTML = buttons.map(b =>
          `<a href="${b.url}" class="chapter-btn ${b.active ? 'active' : ''}">${b.label}</a>`
        ).join('');
      }

      function renderQuiz() {
        const form = document.getElementById('quiz-form');
        window.quizCorrectMap = {};
        const baseSeed = currentChapter * 1000000 + (Date.now() % 1000000);

        form.innerHTML = CHAPTER_CONFIG.assessmentItems.map(q => {
          const seed = baseSeed + parseInt(q.id, 10);
          const shuffledOpts = shuffleWithSeed([...q.options], seed);
          const correct = q.options.find(o => o.is_correct);
          window.quizCorrectMap[q.id] = correct.id;

          const optHtml = shuffledOpts.map((opt, idx) => {
            const letter = String.fromCharCode(65 + idx);
            return `<div class="option"><label><input type="radio" name="q${q.id}" value="${opt.id}" required> ${letter}. ${opt.text}</label></div>`;
          }).join('');

          return `<div class="question"><strong>${q.id}. ${q.prompt}</strong><div class="options">${optHtml}</div></div>`;
        }).join('');
      }

      function showFeedback(answers) {
        const items = CHAPTER_CONFIG.assessmentItems;
        let correctCount = 0, correctList = [], incorrectList = [];

        items.forEach((item, i) => {
          const ans = answers[i];
          const correctId = window.quizCorrectMap[item.id];
          const correctOpt = item.options.find(o => o.id === correctId);
          const isCorrect = ans === correctId;
          if (isCorrect) {
            correctCount++;
            correctList.push(`${item.id}. ${item.prompt} â†’ âœ… ${correctOpt.text}`);
          } else {
            incorrectList.push(`${item.id}. ${item.prompt} â†’ âŒ Your answer: ${item.options.find(o => o.id === ans)?.text || 'â€”'} | âœ… ${correctOpt.text}`);
          }
        });

        const score = correctCount, total = 20, mastery = score >= 15;
        const timeOnTask = Math.floor((Date.now() - window.startTime) / 1000);
        const attempts = (parseInt(localStorage.getItem(`quiz_attempts_${currentChapter}`)) || 0) + 1;
        localStorage.setItem(`quiz_attempts_${currentChapter}`, attempts);
        localStorage.setItem(`mastery_${currentChapter}`, mastery ? '1' : '0');
        const studentName = localStorage.getItem('student_name') || '[Name]';

        logEvent('quiz_submitted', { score, time_sec: timeOnTask, mastery, attempts });
        if (mastery) logEvent('mastery_achieved', {});

        let report = `*Mini OpenStax â€” ${CHAPTER_CONFIG.title}*\nStudent: ${studentName}\nScore: ${score}/${total} (${Math.round(score/total*100)}%) â€” ${mastery ? 'âœ… MASTERED' : 'âŒ Needs Review'}\nTime: ${timeOnTask}s | Attempts: ${attempts}\n\n`;
        if (correctList.length) report += `âœ… CORRECT (${correctList.length}):\n${correctList.join('\n')}\n\n`;
        if (incorrectList.length) report += `âŒ INCORRECT (${incorrectList.length}):\n${incorrectList.join('\n')}\n\n`;
        report += `Report generated via Mini OpenStax.`;

        localStorage.setItem(`saved_report_${currentChapter}_${Date.now()}`, report);

        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(report)}`;
        document.getElementById('feedback').innerHTML = `
          <div class="feedback">
            <h3>ğŸ“Š Results: ${score}/${total}</h3>
            <p><strong>${mastery ? 'ğŸ‰ Excellent!' : score >= 10 ? 'Good!' : 'Keep practicing.'}</strong> ${
              mastery ? 'Youâ€™ve mastered the concept!' :
              score >= 10 ? 'Review missed items.' : 'Practice this lesson again.'
            }</p>
            <p><strong>Time:</strong> ${timeOnTask}s | <strong>Attempts:</strong> ${attempts}</p>
            <a href="${url}" target="_blank" class="btn" style="background:#25D366;text-decoration:none;">
              ğŸ“² Send Report via WhatsApp
            </a>
          </div>
        `;
      }

      function setupQuizListeners() {
        document.getElementById('submit-quiz').addEventListener('click', () => {
          const form = document.getElementById('quiz-form');
          const answers = [];
          for (let i = 1; i <= 20; i++) {
            const el = form.querySelector(`input[name="q${i}"]:checked`);
            answers.push(el ? el.value : null);
          }
          if (answers.includes(null)) {
            alert("Please answer all questions.");
            return;
          }
          showFeedback(answers);
        });
      }

      function initNamePrompt() {
        const saved = localStorage.getItem('student_name');
        const savedRole = localStorage.getItem('user_role') || 'student';
        const promptDiv = document.getElementById('student-name-prompt');
        const quizDiv = document.getElementById('quiz-container');
        const display = document.getElementById('name-display');
        const input = document.getElementById('student-name');
        const buttons = document.getElementById('name-buttons');
        const roleBadge = document.querySelector('.role-badge');
        roleBadge.textContent = savedRole === 'instructor' ? 'Instructor View' : 'Student View';

        if (saved) {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.innerHTML = `<p><strong>Current name:</strong> ${saved} (${savedRole})</p>`;
          buttons.innerHTML = `
            <button type="button" class="btn" id="keep-btn">âœ… Keep This Name</button>
            <button type="button" class="btn btn-secondary" id="change-btn">âœï¸ Use a Different Name</button>
          `;
          document.getElementById('keep-btn').onclick = () => {
            promptDiv.style.display = 'none';
            quizDiv.style.display = 'block';
            logEvent('lesson_start', {});
          };
          document.getElementById('change-btn').onclick = () => {
            display.style.display = 'none';
            input.style.display = 'block';
            buttons.innerHTML = `
              <button type="button" class="btn" id="save-new">ğŸ’¾ Save and Start Quiz</button>
              <div style="margin-top:1rem; font-size:0.9rem;">
                <label>
                  <input type="checkbox" id="teacher-mode"> 
                  I'm an instructor (analytics auto-enabled to improve lessons)
                </label>
              </div>
            `;
            input.value = '';
            input.focus();
            document.getElementById('save-new').onclick = () => {
              const name = input.value.trim();
              if (name) {
                localStorage.setItem('student_name', name);
                const isTeacher = document.getElementById('teacher-mode').checked;
                localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
                if (isTeacher) enableAnalytics();
                promptDiv.style.display = 'none';
                quizDiv.style.display = 'block';
                roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
                logEvent('lesson_start', {});
              } else {
                alert("Please enter your name.");
                input.focus();
              }
            };
          };
        } else {
          promptDiv.style.display = 'block';
          quizDiv.style.display = 'none';
          display.style.display = 'none';
          input.style.display = 'block';
          buttons.innerHTML = `
            <button type="button" class="btn" id="save-first">ğŸ’¾ Save and Start Quiz</button>
            <div style="margin-top:1rem; font-size:0.9rem;">
              <label>
                <input type="checkbox" id="teacher-mode"> 
                I'm an instructor (analytics auto-enabled to improve lessons)
              </label>
            </div>
          `;
          document.getElementById('save-first').onclick = () => {
            const name = input.value.trim();
            if (name) {
              localStorage.setItem('student_name', name);
              const isTeacher = document.getElementById('teacher-mode').checked;
              localStorage.setItem('user_role', isTeacher ? 'instructor' : 'student');
              if (isTeacher) enableAnalytics();
              promptDiv.style.display = 'none';
              quizDiv.style.display = 'block';
              roleBadge.textContent = isTeacher ? 'Instructor View' : 'Student View';
              logEvent('lesson_start', {});
            } else {
              alert("Please enter your name.");
              input.focus();
            }
          };
        }
      }

      function init() {
        renderContent();
        renderNavigation();
        renderQuiz();
        setupQuizListeners();
        initNamePrompt();
      }

      document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('send-analytics').onclick = (e) => {
          e.preventDefault();
          if (confirm('Send anonymous usage data to help improve Mini OpenStax?')) {
            sendAnalyticsEvents();
          }
        };
      });

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
